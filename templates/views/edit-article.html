<!-- Head tags -->
{{ define "head-tags" }}
<link rel="stylesheet" href="https://unpkg.com/easymde/dist/easymde.min.css">
<script src="https://unpkg.com/easymde/dist/easymde.min.js"></script>
{{ end }}
<!-- Content -->
{{ define "yield" }}
<div class="container p-6 md:px-0 md:py12 mx-auto">
  <h1 class="my-4 text-5xl font-semibold leading-tight text-gray-800">Edit This Article</h1>
  <form action="/articles/{{.Article.ID}}?_method=PATCH" method="post">
    {{ template "article-form-fields" . }}
  </form>
  <form id="delete-article-form" action="/articles/{{.Article.ID}}?_method=DELETE" method="post">
    <button class="text-red-500" type="submit">Delete</button>
  </form>
</div>

<script>
  const easyMDE = new EasyMDE({
    autosave: {
      delay: 1000,
      enabled: true,
      text: "Last Saved ",
      uniqueId: "edit-article-{{.Article.ID}}",
    },
    element: document.getElementById("markdown"),
    forceSync: true,
    maxHeight: "500px",
    initialValue: "{{ .Article.Markdown }}",
  })

  const deleteForm = document.querySelector("#delete-article-form")
  const cancelBtn = document.querySelector("#cancel-edit")
  deleteForm.addEventListener("submit", (e) => {
    if (!confirm("Are you sure you want to delete this article?")) {
      e.preventDefault()
      return
    }
  })
  cancelBtn.addEventListener("click", () => {
    easyMDE.clearAutosavedValue()
  })
</script>
{{ end }}